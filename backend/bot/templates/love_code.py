from aiogram.types import InlineKeyboardMarkup

from bot.keyboards.inline import (
    get_to_registration_kb,
    get_to_subscription_plans_kb,
)
from bot.keyboards.utils import one_button_keyboard
from core.models import Client


def get_love_code_intro(client: Client) -> tuple[str, InlineKeyboardMarkup]:
    if not client.is_registered():
        return (
            'Ты хочешь любви.\n'
            'Но пока не знаешь, как любишь сам(а).\n\n'
            'Пройди регистрацию — и я покажу твой способ чувствовать.',
            get_to_registration_kb(
                back_button_data='to_personal_analysis',
            ),
        )
    elif client.subscription_is_active() or client.has_trial():
        return (
            'Ты любишь не как все.\n'
            'Интуитивно. Сильно. Не по правилам.\n'
            'Пора понять, на каком языке говорит твоё сердце.',
            one_button_keyboard(
                text='Узнать',
                callback_data='show_love_code',
                back_button_data='to_personal_analysis',
            ),
        )
    else:
        return (
            'Любовь уже постучалась.\n'
            'Ты просто ещё не полностью открыл(а) дверь.\n\n'
            'Позволь себе войти глубже. Я рядом.',
            get_to_subscription_plans_kb(
                back_button_data='to_personal_analysis',
            ),
        )


def get_love_code_text(client: Client) -> str:
    moon_sign = [i for i in client.planets if i['name'] == 'Луна'][0]['sign']
    venus_sign = [i for i in client.planets if i['name'] == 'Венера'][0]['sign']
    house_7 = [i for i in client.planets if i['house'] == 7][0]['house']
    if client.subscription_is_active():
        return (
            '❤️ Твой код любви\n\n'
            'Любовь — это не сценарий.\n'
            'Это способ быть увиденным.\n'
            'И иногда, чтобы понять, что ты хочешь в любви,\n'
            'нужно сначала понять — как ты вообще чувствуешь.\n\n'
            'Твои чувства — не ошибка. Даже если они пугают. Даже если ты не привык(-ла) их показывать.\n\n'
            '1. Луна — эмоции, потребности, глубина чувств\n'
            'Луна — это не про то, как ты выглядишь в отношениях.\n'
            'А про то, как ты переживаешь внутри.\n'
            '{положение Луны — как человек чувствует, что ему нужно для эмоциональной безопасности, как проявляются эмоции в близости.}\n\n'
            '2. Венера — как ты любишь и что тебе важно в отношениях\n'
            'Ты не просто любишь.\n'
            'Ты любишь по-своему.\n'
            'И Венера показывает, как.\n'
            '{положение Венеры — язык любви, что важно в партнёрстве, как человек проявляет симпатию, чувственность, привязанность.}\n\n'
            '3. 7 дом — твоя зона партнёрства\n'
            'Партнёрство — это не «идеальная пара». Это контакт. Это вызов. Это отражение.\n'
            '7 дом говорит о том, каких людей ты притягиваешь и какие сценарии строишь вблизи.\n'
            '{положение 7 дома — тип партнёров, модели взаимодействия, ожидания от «мы».}\n\n'
            '4. Число души (нумерология)\n'
            'Когда ты влюбляешься, включается не логика, а душа.\n'
            'И у неё — свои запросы.\n'
            '{число души — что ценно в партнёрстве, как человек раскрывается эмоционально и духовно.}\n\n'
            '5. Архетип Юнга — твоя роль в отношениях\n'
            'Ты входишь в отношения не как «просто ты».\n'
            'Ты входишь в определённой роли.\n'
            'Архетип — это не маска. Это настройка.\n'
            '{архетип — как человек проявляется в любви, что несёт партнёру, какие паттерны разыгрывает — Любовник, Герой, Искатель и т.д.}\n\n'
            'Финал\n'
            'Ты можешь прятаться.\n'
            'Ты можешь играть «холодного» или «удобного».\n'
            'Но внутри всегда звучит:\n'
            '«Покажи меня. Полностью. Без фильтров».\n'
            'Любовь — это риск. Но только она пробуждает ту часть тебя, которая больше не хочет спать.'
        )
    elif client.has_trial():
        return (
            '❤️ Твой код любви (экспресс-версия)\n\n'
            'Луна\n'
            'Твои эмоции — это способ быть.\n'
            'Луна показывает, что делает тебя тёплым, уязвимым, живым.\n'
            '{краткое описание Луны — эмоциональные потребности}\n\n'
            'Венера\n'
            'Ты любишь по-особенному.\n'
            'Венера — про то, как ты проявляешь чувства и что тебе действительно нужно в отношениях.\n'
            '{краткое описание Венеры}\n\n'
            '7 дом\n'
            'Ты не просто встречаешь людей.\n'
            'Ты создаёшь с ними динамику.\n'
            '7 дом — про то, с кем ты строишь «мы». И как ты в этом «мы» раскрываешься.\n'
            '{краткое описание 7 дома}\n\n'
            'Число души\n'
            'Когда ты выбираешь сердцем — включается не голова. Включается душа.\n'
            'И у неё — свои ориентиры.\n'
            '{число души — краткое описание}\n\n'
            'Архетип\n'
            'Ты входишь в отношения с определённой энергией.\n'
            'Это не маска. Это код.\n'
            '{архетип — краткое описание роли в любви}\n\n'
            'Финал\n'
            'Ты можешь притворяться, что тебе всё равно.\n'
            'Но внутри всегда звучит: «Скажи мне правду. Обними без защиты. Останься, даже если страшно».\n'
            'Это и есть любовь. Без костюмов.'
        )
